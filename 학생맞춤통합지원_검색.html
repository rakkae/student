<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>학생맞춤통합지원 안내 챗봇</title>
</head>
<body style="font-family:'Malgun Gothic',sans-serif;background:#f0f4f8;margin:0;padding:0;height:100vh;display:flex;flex-direction:column;">

<div style="background:linear-gradient(135deg,#1e3a5f,#3b82f6);color:#fff;padding:16px 20px;text-align:center;">
<h1 style="margin:0;font-size:1.3rem;">학생맞춤통합지원 안내 챗봇</h1>
<p style="margin:4px 0 0;font-size:0.85rem;opacity:0.9;">2025 가이드북 기반</p>
</div>

<div id="chatContainer" style="flex:1;overflow-y:auto;padding:16px;display:flex;flex-direction:column;gap:12px;">
<div style="background:#fff;padding:12px 16px;border-radius:12px;border-left:4px solid #3b82f6;max-width:85%;box-shadow:0 1px 3px rgba(0,0,0,0.08);">
안녕하세요! 학생맞춤통합지원에 대해 궁금한 점을 물어보세요.<br><br>
<b>예시 질문:</b><br>
• 학생맞춤통합지원이 뭔가요?<br>
• 통합지원팀은 어떻게 구성하나요?<br>
• 위기학생 발견 절차가 어떻게 되나요?<br>
• 경제적 어려움이 있는 학생 지원 방법은?
</div>
</div>

<div style="padding:12px 16px;background:#fff;border-top:1px solid #e5e7eb;">
<div style="display:flex;gap:8px;max-width:900px;margin:0 auto;">
<input type="text" id="userInput" placeholder="질문을 입력하세요..." style="flex:1;padding:12px;border:1px solid #ddd;border-radius:8px;font-size:14px;" onkeypress="if(event.key==='Enter')sendMessage()">
<button onclick="sendMessage()" id="sendBtn" style="padding:12px 20px;background:#3b82f6;color:#fff;border:none;border-radius:8px;cursor:pointer;font-weight:600;">전송</button>
</div>
<p style="text-align:center;margin:8px 0 0;font-size:11px;color:#999;">AI 답변은 참고용입니다. 정확한 정보는 가이드북 원문을 확인해주세요.</p>
</div>

<script>
var WORKER_URL = 'https://gemini-proxy.ska13g.workers.dev/';

function addMessage(text, type) {
  var container = document.getElementById('chatContainer');
  var div = document.createElement('div');
  if(type === 'user') {
    div.style.cssText = 'background:#3b82f6;color:#fff;padding:12px 16px;border-radius:12px;max-width:85%;margin-left:auto;';
  } else {
    div.style.cssText = 'background:#fff;padding:12px 16px;border-radius:12px;border-left:4px solid #3b82f6;max-width:85%;box-shadow:0 1px 3px rgba(0,0,0,0.08);';
  }
  div.innerHTML = text.replace(/\n/g, '<br>');
  container.appendChild(div);
  container.scrollTop = container.scrollHeight;
  return div;
}

async function sendMessage() {
  var input = document.getElementById('userInput');
  var question = input.value.trim();
  if(!question) return;
  
  document.getElementById('sendBtn').disabled = true;
  addMessage(question, 'user');
  input.value = '';
  
  var loadingDiv = addMessage('답변 생성 중...', 'bot');
  
  try {
    var response = await fetch(WORKER_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ question: question })
    });
    
    var data = await response.json();
    loadingDiv.remove();
    
    if(data.candidates && data.candidates[0] && data.candidates[0].content) {
      var answer = data.candidates[0].content.parts[0].text;
      addMessage(answer, 'bot');
    } else if(data.error) {
      addMessage('오류: ' + data.error.message, 'bot');
    } else {
      addMessage('응답을 처리할 수 없습니다.', 'bot');
    }
  } catch(e) {
    loadingDiv.remove();
    addMessage('오류가 발생했습니다: ' + e.message, 'bot');
  }
  
  document.getElementById('sendBtn').disabled = false;
}
</script>
</body>
</html>
